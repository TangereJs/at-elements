<link rel="import" href="at-elements.html">
<link rel="import" href="../at-theme/at-theme.html">
<link rel="import" href="../at-core-splitter/at-core-splitter.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="at-elements-tree.html">

<dom-module id="at-elements-catalog-new">
  <style include="iron-flex"></style>
  <style include="iron-flex-alignment"></style>
  <style include="iron-flex-factors"></style>
  <style include="at-form-common"></style>
  <style>
     :host {
      display: block;
      box-sizing: border-box;
    }

    .left-column {
      width: 400px;
    }

    .right-column {
      position: relative;
    }

    .frame-class {
      position: absolute;
      height: 100%;
      width: 100%;
    }

    .clear-float {
      clear: both;
    }
  </style>
  <template>
    <div class="horizontal layout">
      <div class="left-column">
        <at-elements-tree id="elementsTree"></at-elements-tree>
      </div>
      <at-core-splitter direction="left" min-size="128px"></at-core-splitter>
      <div id="rightColumn" class="right-column flex">
        <at-core-resize-sensor id="resizeSensor" on-resize-sensed="_handleResizeSensed"></at-core-resize-sensor>
        <div class="clear-float"></div>
        <div>
          <iframe id="iframe" frameborder="0" class="frame-class"></iframe>
        </div>
      </div>
    </div>
  </template>
  <script>
    'use strict';
    Polymer({
      is: 'at-elements-catalog-new',

      properties: {},

      listeners: {
        'elementsTree.select': '_handleElementTreeSelected'
      },

      ready: function() {

      },

      _handleResizeSensed: function (event) {
        var dimensions = event.detail.value;

        var iframeClientRect = this.$.iframe.contentDocument.body.getBoundingClientRect();
        rightColumn.style.height = iframeClientRect.height + "px";

        console.log('resize sensed');
      },

      _handleElementTreeSelected: function(event) {
        var elementName = event.detail.getAttribute('data-node-id');

        if (elementName.indexOf('-') === -1) {
          return;
        }

        var ununIndex = elementName.indexOf('__');
        if (ununIndex > -1) {
          elementName = elementName.substr(0, ununIndex);
        }

        console.log(elementName);

        var pathParts = window.location.pathname.split("/");
        pathParts[pathParts.length - 2] = elementName;
        pathParts[pathParts.length - 1] = "index.html";
        var path = pathParts.join("/");
        var readmeDownloadUrl = [window.location.origin, path].join("");

        this.$.iframe.setAttribute('src', readmeDownloadUrl);
      }
    });
  </script>
</dom-module>
